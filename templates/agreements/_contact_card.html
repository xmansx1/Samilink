{# components/_user_card.html #}
{# Ù…ØªØºÙŠÙ‘Ø±Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© ÙŠÙ…ÙƒÙ† ØªÙ…Ø±ÙŠØ±Ù‡Ø§ Ù…Ø¹ include:
   - context_msg: Ù†Øµ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ (Ø³ÙŠÙ…Ø±Ù‘ Ø¹Ø¨Ø± urlencode)
   - show_actions: Ø§ÙØªØ±Ø§Ø¶ÙŠ True Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„
   - accent: 'indigo'/'emerald' ... Ù„ØªØ®ØµÙŠØµ Ø§Ù„ØªØ¯Ø±Ù‘Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ indigo-sky)
#}

{% with _show_actions=show_actions|default_if_none:True %}
{% with _context_msg=context_msg|default:"Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµÙ‘Ø©" %}
{% with _uid="uc-"|add:(user.id|default:user.email|default:"x")|slugify %}

<div id="{{ _uid }}" class="rounded-2xl border bg-white/70 backdrop-blur shadow-glass-lg overflow-hidden" data-component="user-card">
  <!-- Ù‡ÙŠØ¯Ø± Ù…ØªØ¯Ø±Ù‘Ø¬ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¯ÙˆØ± (Ø¥Ù† ÙˆÙØ¬Ø¯) -->
  <div class="px-5 py-4 bg-gradient-to-l from-indigo-50 to-sky-50 border-b">
    <div class="flex items-center gap-3">
      <!-- Ø£ÙØ§ØªØ§Ø± -->
      <div class="relative shrink-0">
        {% if user.avatar_url %}
          <img src="{{ user.avatar_url }}" alt="ØµÙˆØ±Ø© {{ user.name|default:user.email|default:'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' }}"
               class="h-12 w-12 rounded-full ring-2 ring-white object-cover"
               loading="lazy" referrerpolicy="no-referrer">
        {% else %}
          <div class="h-12 w-12 rounded-full bg-indigo-600 text-white grid place-items-center text-lg font-bold select-none">
            {% if user.name %}{{ user.name|first }}{% else %}ğŸ‘¤{% endif %}
          </div>
        {% endif %}
      </div>

      <div class="min-w-0">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="text-slate-900 font-extrabold text-base md:text-lg truncate">
            {{ user.name|default:user.email|default:"Ù…Ø³ØªØ®Ø¯Ù…" }}
          </h3>
          {% if user.role %}
            <span class="px-2 py-0.5 rounded-xl text-[11px] md:text-xs bg-slate-100 text-slate-700">
              {{ user.role }}
            </span>
          {% endif %}
        </div>
        {% if user.email %}
          <p class="text-slate-600 text-xs md:text-sm truncate">{{ user.email }}</p>
        {% else %}
          <p class="text-slate-500 text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù‘Ù„</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
  <div class="p-5 space-y-4">

    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div class="p-3 rounded-xl bg-slate-50 border">
        <div class="text-xs text-slate-500">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
        <div class="mt-0.5 font-medium text-slate-800 break-all">
          {{ user.email|default:"â€” ØºÙŠØ± Ù…ØªÙˆÙØ± â€”" }}
        </div>
      </div>
      <div class="p-3 rounded-xl bg-slate-50 border">
        <div class="text-xs text-slate-500">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</div>
        <div class="mt-0.5 font-medium text-slate-800">
          {% if user.phone %}{{ user.phone }}{% else %}â€” ØºÙŠØ± Ù…ØªÙˆÙØ± â€”{% endif %}
        </div>
      </div>
      {% if user.company %}
      <div class="p-3 rounded-xl bg-slate-50 border">
        <div class="text-xs text-slate-500">Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</div>
        <div class="mt-0.5 font-medium text-slate-800">
          {{ user.company }}
        </div>
      </div>
      {% endif %}
    </div>

    {% if _show_actions %}
    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ -->
    <div class="flex flex-wrap items-center gap-2">
      {% if user.email %}
        <a href="mailto:{{ user.email }}"
           class="px-3 py-2 rounded-xl border hover:bg-slate-50 text-slate-700"
           rel="noopener">
          Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        </a>
        <button type="button"
                class="px-3 py-2 rounded-xl border hover:bg-slate-50 text-slate-700"
                data-copy="{{ user.email }}"
                aria-label="Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
          Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯
        </button>
      {% endif %}

      {% if user.phone %}
        {# Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø³ÙŠØ§Ù‚ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ù…Ù† include #}
        <a href="{% url 'core:whatsapp_user' user.id %}?msg={{ _context_msg|urlencode }}"
           class="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700"
           data-wp-msg="{{ _context_msg }}">
          ÙˆØ§ØªØ³Ø§Ø¨
        </a>
        <a href="tel:{{ user.phone|urlencode }}"
           class="px-3 py-2 rounded-xl border hover:bg-slate-50 text-slate-700"
           rel="noopener">
          Ø§ØªØµØ§Ù„
        </a>
        <button type="button"
                class="px-3 py-2 rounded-xl border hover:bg-slate-50 text-slate-700"
                data-copy="{{ user.phone }}"
                aria-label="Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
          Ù†Ø³Ø® Ø§Ù„Ø¬ÙˆØ§Ù„
        </button>
      {% else %}
        <span class="px-3 py-2 rounded-xl bg-slate-100 text-slate-500 text-xs">
          Ù„Ø§ ÙŠØªÙˆÙØ± Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨
        </span>
      {% endif %}
    </div>
    {% endif %}

  </div>
</div>

<!-- Ø³ÙƒØ±Ø¨Øª Ø®ÙÙŠÙ Ø°Ø§ØªÙŠ-Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø¨Ø± Ø§Ù„Ù€ id (ÙŠØ¯Ø¹Ù… ØªØ¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® Ø¯ÙˆÙ† ØªØ¹Ø§Ø±Ø¶) -->
<script>
(function () {
  var root = document.getElementById('{{ _uid }}');
  if (!root) return;

  // Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
  var btns = root.querySelectorAll('[data-copy]');
  if (btns.length && navigator.clipboard) {
    btns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var val = btn.getAttribute('data-copy') || '';
        if (!val) return;
        navigator.clipboard.writeText(val).then(function () {
          toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“');
        }).catch(function () {
          // fallback Ø¨Ø³ÙŠØ·
          try {
            var ta = document.createElement('textarea');
            ta.value = val; document.body.appendChild(ta);
            ta.select(); document.execCommand('copy'); ta.remove();
            toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“');
          } catch (e) {}
        });
      });
    });
  }

  // Ø¯Ø§Ù„Ø© Toast Ù…Ø­Ù„ÙŠØ©
  function toast(msg) {
    var t = document.createElement('div');
    t.textContent = msg || '';
    t.setAttribute('role', 'status');
    t.setAttribute('aria-live', 'polite');
    t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm px-3 py-1.5 rounded-xl shadow z-[60]';
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); }, 1400);
  }
})();
</script>

{% endwith %}{% endwith %}{% endwith %}
